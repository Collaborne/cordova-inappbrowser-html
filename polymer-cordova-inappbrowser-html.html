<link rel="import" href="../polymer/polymer.html">

<dom-module id="polymer-cordova-inappbrowser-html">
</dom-module>

<script>

(function() {

	Polymer({
		is: 'polymer-cordova-inappbrowser-html',
		properties: {
			html: {
				type: String,
				value: '',
				observer: '_refreshHtml'
			}
		},

		ready: function() {
			this._refreshHtml();
		},

		// Private methods
		_refreshHtml: function() {
			this.innerHTML = this.html;
			
			// Wait until the DOM is updated
			this.async(function() {
				// Iterate over all anchors to manipulate the external links
				var anchors = Polymer.dom(this.root).querySelectorAll('a');
				for (var i = 0, len = anchors.length; i < len; i++) {
					// Is this an external link?
					var href = anchors[i].getAttribute('href');
					if (typeof href === 'string' && !href.startsWith("#")) {
						// External links need to be opened in the InAppBrowser. This avoids in native Cordova apps that the WebView replaces the app with the content of the external link.
						anchors[i].onclick = (function(href) {
							return function() {
								// Open in InAppBrowser
								// @see https://github.com/apache/cordova-plugin-inappbrowser
								window.open(href, "_blank", "location=yes,EnableViewPortScale=yes");

								// Block the browsers default behavior
								return false;
							}
						})(href);
					}
				}
			});
		}
	});

})();

</script>
